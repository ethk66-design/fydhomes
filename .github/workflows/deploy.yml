name: Build and Deploy to Hostinger

on:
  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üöö Get latest code
        uses: actions/checkout@v4

      - name: üü¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: üì¶ Install Dependencies
        run: npm ci

      - name: üß¨ Generate Prisma Client
        # We need the client to build the app
        run: npx prisma generate

      - name: üèóÔ∏è Build Project
        # We disable linting/typechecking during build to save time/errors
        # The build artifact will be in .next/
        run: npm run build
        env:
          # Next.js needs these to know how to build, even if they aren't used at runtime
          NEXT_PUBLIC_BASE_URL: https://new.fydhomes.in
          # If your build needs DB connection (static pages), you might need DATABASE_URL here
          # For now, assuming static generation doesn't hit DB or fails gracefully
          CI: true

      - name: üìÇ Sync files (FTP)
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          # Protocol needs to be explicitly insecure for some shared hosts if FTPS fails, 
          # but normally try secure first. Hostinger supports FTPS.
          protocol: ftps
          # What to upload
          local-dir: ./
          # Where to upload (usually public_html/ or just / for the root of the FTP user)
          server-dir: ./
          # Do not delete these files on the server (User uploads, env, etc)
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/src/**
            **/scripts/**
            **/prisma/**
            .env
            .env.local
            README.md
            tsconfigs.json
            tailwind.config.ts
            postcss.config.js
            eslint.config.mjs
            components.json
            task.md
            *.sql
            *.log
